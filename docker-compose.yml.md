# ============================================================
# airis-workspace Workspace - Monorepo Dev Shell
# ============================================================
# Provides a single container with pnpm/node toolchain for running
# monorepo commands (`airis shell`, `airis install`, etc).
# ============================================================
# Generated by `airis init` - DO NOT EDIT MANUALLY
# Source of truth: manifest.toml
# ============================================================

services:
  workspace:
    container_name: airis-workspace-workspace
    build:
      context: .
      dockerfile: Dockerfile.dev
    volumes:
      # ソースコード: :delegated で macOS I/O を最適化
      - ./:/app:delegated
      # 依存・ビルド: named volume で完全隔離（manifest.toml [workspace].volumes で定義）
      - workspace-node-modules:/app/node_modules
    working_dir: /app
    expose:
      - "3000"
    environment:
      CHOKIDAR_USEPOLLING: "true"
      CHOKIDAR_INTERVAL: "200"
      WATCHPACK_POLLING: "true"
      NODE_ENV: development
    extra_hosts:
      - "host.docker.internal:host-gateway"
    command: sleep infinity
    networks:
      - default
    labels:
      - "traefik.enable=false"
    develop:
      watch:
        - path: .
          action: sync
          target: /app
          ignore:
            - node_modules/
            - .next/
            - dist/
            - .turbo/

  postgres:
    image: postgres:16-alpine
    ports:
      - "5432:5432"

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"


networks:
  default:
    name: airis-workspace_default
    external: false
  coolify:
    external: true

volumes:
  workspace-node-modules:
