version = 1
mode = "docker-first"

[workspace]
name = "airis-workspace"
package_manager = "pnpm@10.22.0"
service = "workspace"
image = "node:22-alpine"
workdir = "/app"
volumes = ["workspace-node-modules:/app/node_modules"]

[catalog]

[workspaces]
apps = []
libs = []

[dev]
autostart = [
    "corporate-site",
    "airis-dashboard",
    "airis-auto-call",
    "focustoday-web",
]

[apps.corporate-site]
path = "apps/corporate-site"
type = "nextjs"
port = 3000

[apps.airis-dashboard]
path = "apps/airis-dashboard"
type = "nextjs"
port = 3100

[apps.airis-auto-call]
path = "apps/airis-auto-call"
type = "nextjs"
port = 3200

[apps.focustoday-web]
path = "apps/focustoday-web"
type = "nextjs"
port = 3400

[libs.ui]
path = "libs/ui"

[libs.env-config]
path = "libs/env-config"

[libs.security]
path = "libs/security"

[docker]
baseImage = "node:24-bookworm"
workdir = "/app"

[docker.workspace]
service = "workspace"
volumes = ["node_modules"]

[just]
output = "justfile"
features = [
    "docker-first-guard",
    "type-specific-commands",
]

[service.postgres]
image = "postgres:16-alpine"
port = 5432
volumes = []

[service.postgres.env]

[service.redis]
image = "redis:7-alpine"
port = 6379
volumes = []

[service.redis.env]

[rule.verify]
commands = [
    "just lint",
    "just test-all",
]

[rule.ci]
commands = [
    "just lint",
    "just test-all",
    "just typecheck",
]

[packages]
workspaces = [
    "apps/*",
    "libs/*",
    "packages/*",
]
app = []

[packages.catalog]
react = "latest"
next = "latest"
typescript = "latest"
tailwindcss = "latest"
hono = "latest"
drizzle-orm = "latest"
zod = "latest"
vitest = "latest"
playwright = "latest"
eslint = "latest"
prettier = "latest"

[packages.catalog.react-dom]
follow = "react"

[packages.catalog.react-is]
follow = "react"

[packages.root.dependencies]

[packages.root.devDependencies]

[packages.root.optionalDependencies]

[packages.root.scripts]
dev = "echo 'Run: just dev-<app-name>'"
build = "echo 'Run: just build-<app-name>'"
lint = "echo 'Run: just lint'"
test = "echo 'Run: just test'"

[packages.root.engines]

[packages.root.pnpm]
onlyBuiltDependencies = []

[packages.root.pnpm.overrides]

[packages.root.pnpm.peerDependencyRules]
ignoreMissing = []

[packages.root.pnpm.peerDependencyRules.allowedVersions]

[packages.root.pnpm.allowedScripts]

[guards]
deny = [
    "npm",
    "yarn",
    "pnpm",
    "bun",
]
forbid = [
    "npm",
    "yarn",
    "pnpm",
    "docker",
    "docker-compose",
]
danger = [
    "rm -rf /",
    "chmod -R 777",
    "chown -R",
]

[guards.wrap]

[guards.deny_with_message]

[[project]]
name = "corporate-site"
kind = "app"
path = "apps/corporate-site"
framework = "react-vite"

[project.scripts]
dev = "vite dev"
build = "vite build"
lint = "eslint ."
test = "vitest"

[project.deps]
react = "catalog"
react-dom = "catalog"

[project.dev_deps]
typescript = "catalog"
vite = "catalog"
vitest = "catalog"
eslint = "catalog"

[orchestration.dev]
workspace = "workspace/docker-compose.yml"
supabase = [
    "supabase/docker-compose.yml",
    "supabase/docker-compose.override.yml",
]
traefik = "traefik/docker-compose.yml"

[commands]
install = "docker compose exec workspace pnpm install"
up = "docker compose up -d"
down = "docker compose down"
shell = "docker compose exec workspace bash"
dev = "echo 'ðŸš€ Starting dev servers...'; docker compose exec workspace pnpm run dev"
build = "docker compose exec workspace pnpm build"
test = "docker compose exec workspace pnpm test"
lint = "docker compose exec workspace pnpm lint"
clean = "echo 'ðŸ§¹ Cleaning build artifacts...'; find . -type d -name 'node_modules' -o -name 'dist' -o -name '.next' -o -name 'build' | xargs rm -rf"

[remap]
"npm install" = "airis install"
"pnpm install" = "airis install"
"yarn install" = "airis install"
"npm run dev" = "airis dev"
"pnpm dev" = "airis dev"
"docker compose up" = "airis up"
"docker compose up -d" = "airis up"
"docker compose down" = "airis down"
"docker exec" = "airis shell"

[versioning]
strategy = "manual"
source = "0.1.1"

[docs]
targets = []
mode = "warn"
