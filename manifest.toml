# Airis Workspace Manifest
# Single source of truth for workspace configuration
# All other files (package.json, justfile, etc.) are AUTO-GENERATED from this file

version = 1
mode = "docker-first"

# Workspace metadata
[workspace]
name = "airis-workspace"
package_manager = "pnpm@10.22.0"
service = "workspace"
image = "node:22-alpine"
workdir = "/app"
volumes = ["workspace-node-modules:/app/node_modules"]

# Package workspace patterns (for pnpm-workspace.yaml)
[packages]
workspaces = ["apps/*", "libs/*", "packages/*"]

# Dependency catalog (version management)
# Reference in package.json as "dep": "catalog:"
# Policies: "latest" | "lts" | "^X.Y.Z" | { follow = "package" }
[packages.catalog]
# Frontend - React ecosystem (version pegging)
react = "latest"
react-dom = { follow = "react" }
react-is = { follow = "react" }

# Frontend - Next.js
next = "latest"

# TypeScript
typescript = "latest"
tailwindcss = "latest"

# Backend
hono = "latest"
drizzle-orm = "latest"

# Shared
zod = "latest"

# Dev Dependencies
vitest = "latest"
playwright = "latest"
eslint = "latest"
prettier = "latest"

# Root package definition
[packages.root]

[packages.root.dependencies]

[packages.root.dev_dependencies]
typescript = "5.6.3"
eslint = "9.10.0"
prettier = "3.3.0"

[packages.root.scripts]
dev = "echo 'Run: just dev-<app-name>'"
build = "echo 'Run: just build-<app-name>'"
lint = "echo 'Run: just lint'"
test = "echo 'Run: just test'"

# App configurations
[apps.corporate-site]
path = "apps/corporate-site"
type = "nextjs"
port = 3000

[apps.airis-dashboard]
path = "apps/airis-dashboard"
type = "nextjs"
port = 3100

[apps.airis-auto-call]
path = "apps/airis-auto-call"
type = "nextjs"
port = 3200

[apps.focustoday-web]
path = "apps/focustoday-web"
type = "nextjs"
port = 3400

# Library configurations
[libs.ui]
path = "libs/ui"

[libs.env-config]
path = "libs/env-config"

[libs.security]
path = "libs/security"

# Docker configuration
[docker]
baseImage = "node:24-bookworm"
workdir = "/app"

[docker.workspace]
service = "workspace"
volumes = ["node_modules"]

# Development autostart apps
[dev]
autostart = [
  "corporate-site",
  "airis-dashboard",
  "airis-auto-call",
  "focustoday-web",
]

# Dev Stack Orchestration
# airis init auto-detects these paths from your existing project
[orchestration.dev]
workspace = "workspace/docker-compose.yml"
supabase = [
  "supabase/docker-compose.yml",
  "supabase/docker-compose.override.yml",
]
traefik = "traefik/docker-compose.yml"

# Just configuration
[just]
output = "justfile"
features = ["docker-first-guard", "type-specific-commands"]

# Service definitions (infra services)
[service.postgres]
image = "postgres:16-alpine"
port = 5432

[service.redis]
image = "redis:7-alpine"
port = 6379

# Rules enforcement (lint/test/verify commands)
[rule.verify]
commands = [
  "just lint",
  "just test-all",
]

[rule.ci]
commands = [
  "just lint",
  "just test-all",
  "just typecheck",
]

# Command guards (prevent host-level package manager usage)
[guards]
block = ["npm", "yarn", "pnpm", "bun"]
message = "‚ùå Direct package manager usage is blocked. Use 'just install' instead."
